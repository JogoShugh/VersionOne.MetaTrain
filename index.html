<html lang="en" >
<head>
	<title>VersionOne MetaTrain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
	<link href='json-formatter.css' rel='stylesheet' media='screen' />
	<link href='styles.css' rel='stylesheet' media='screen' />

</head>
<body ng-cloak>
  <!--
    Your HTML content here
  -->

  <!-- Angular Material requires Angular.js Libraries -->
	<script src="https://use.fontawesome.com/74045bd630.js"></script>
	<script src='lib/jquery/jquery-1.10.2.min.js'></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-resource.min.js"></script>
	<!-- Angular Material Library -->
  <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
	<script src='js/underscore.min.js'></script>
	<script src='js/yaml.min.js'></script>
	<script src='js/json-formatter.js'></script>

	<section ng-controller='HomeController'>
		<section>
			<center>
				<h1 class='md-display-4'>MetaTrain</h1>
				<br />
				<h3 class='md-headline'>I hear the train a comin'</h3>
				<br />
				<a href='https://www.youtube.com/watch?v=UZkrVSB4uAw' target='_blank'><img src='johnny.png' /></a>
			</center>
		</section>

		<section>
			<center><h3 class='md-display-3'>Pick an Asset Type</h3></center>
			<section layout='row' layout-sm='column' layout-align='center center' layout-wrap='' ng-show='assetsVisible'>
				<span ng-repeat='type in assetTypes.types'><md-button class='md-raised md-maintain-case' ng-class='{"md-primary": highlightedAsset(type)}' ng-click='assetSelect(type)'>&nbsp;{{type.Name}}&nbsp;</md-button>&nbsp;&nbsp;</span>
			</section>
		</section>

   	<section layout='row' layout-sm='column' layout-align='center center' layout-wrap='' ng-show='!assetsVisible' ng-cloak>
			<md-button class='md-raised md-primary' ng-click='assetTypesShow()'><i class='icon-backward'>&nbsp;</i> Reset</md-button>
		</section>

		<section layout='row' layout-sm='column' layout-wrap=''>
			<div class='span8'>
				<div ng-repeat='item in metaList' ng-cloak>
					<div ng-init='expanded = true' ng-show='item.visible'>
						<a name='asset-type'></a><span ng-show='metaList.length != 1' ng-click='metaBack()'><i class='icon-circle-arrow-left'></i> <b>back</b>&nbsp;</span>
						<div ng-show='expanded' class='details'>
							<md-content class="md-padding">
						    <md-tabs md-selected="selectedIndex" md-border-bottom="" md-autoselect="" md-dynamic-height="">
						      <md-tab label="{{item.AssetName}}">
										<md-input-container>
							        <label>I'm looking for</label>
							        <input ng-model='attributeSearch.search'>
							      </md-input-container>
										&nbsp;<span style='font-size: 75%; color: darkgray'><input type='checkbox' ng-model='attributeSearch.prefixMatch'>&nbsp;prefix-match</span>
							  		<table class='table table-bordered table-striped table-nonfluid'>
							  			<tr>
							  				<th colspan='4' class='attribute-heading'>Scalar Attributes</th>
							  			</tr>
							  			<tr>
							  				<th>Name</th>
							  				<th><a href='http://community.versionone.com/VersionOne_Connect/Developer_Library/Getting_Started/Platform_Concepts/Attribute_Types' target='_blank'>Type</a></th>
							  				<th colspan='2'>Meta Info</th>
							  			</tr>
							  			<tr ng-repeat='attr in item.Attributes' ng-show='attributeMatchesFilter(attr.Name)'>
							  				<td class='attribute' ng-class='{selected: selected(attr.Name)}'>
							  					<i class='fa fa-check' ng-show='!selected(attr.Name)'
							  						ng-click='toggleSelect(attr.Name)'>&nbsp;</i>
							  					<i class='fa fa-remove' ng-show='selected(attr.Name)'
							  						ng-click='toggleSelect(attr.Name)'></i>
							  					{{attr.Name}} <i class='fa fa-filter' ng-click='toggleFilter(attr)'>&nbsp;</i><i class='fa fa-sort-up' ng-click='sortUp(attr)'>&nbsp;</i><i class='fa fa-sort-down' ng-click='sortDown(attr)'>&nbsp;</i>
							  					<div ng-show='attr.filterVisible' class='well well-small'>
							  						<div ng-repeat='filter in attr.filters'>
							  							<table border='0' cellpadding='0' cellspacing='0'>
							  								<tr style='border-top: 2px solid goldenrod'>
							  									<td style='padding: 10px'>
																	<span style='font-size: 80%' ng-click='filterRemove(attr, filter); filtersUpdate(item)'><i class='icon-minus-sign' label='Remove filter'>&nbsp;</i></span>
							  									</td>
							  									<td>
																		<md-input-container style='margin-right: 10px;'>
																			<label>Operator</label>
															        <md-select ng-model='filter.operator' ng-change='filtersUpdate(item)'>
															          <md-option ng-repeat='(key, value) in operatorsMap' value='{{key}}'>{{value}}</md-option>
															        </md-select>
																		</md-input-container>
								  								</td>
								  								<td>
								  									<span ng-repeat='filterValue in filter.values'>
																			<md-input-container>
																        <label>filter value</label>
																        <input ng-model='filterValue.value' ng-change='filtersUpdate(item)'>
																      </md-input-container>
																			<i class='fa fa-remove' ng-click='filterValueRemove(filter, filterValue);filtersUpdate(item)'>&nbsp;</i>
									  									<br />
								  									</span>
									  								<span style='font-size: 70%; top: -10px; position: relative;' class><span ng-click='filterValueAdd(filter)'><i class='fa fa-plus'>&nbsp;</i> Add <b>OR</b> Value</span></span>
									  							</td>
									  						</tr>
									  					</table>
							  						</div>
														<md-button class='md-primary md-raised' ng-click='filterAdd(attr)'><i class='fa fa-plus'>&nbsp;</i> Add Filter</md-button>
							  					</div>
							  				</td>
							  				<td>{{attr.AttributeType}}</td>
							  				<td colspan='2'>
							  					<md-button md-colors="{background: 'red'}" ng-show='attr.IsRequired'>required</md-button> <md-button md-colors="{background: 'yellow'}" ng-show='attr.IsReadOnly'>read only</md-button> <md-button md-colors="{background: 'green'}" ng-show='!attr.IsReadOnly'>read/write</md-button>
							  				</td>
							  			</tr>
							  			<tr>
							  				<th colspan='4' class='attribute-heading'>Relations</th>
							  			</tr>
							  			<tr>
							  				<th>Name</th>
							  				<th>Type</th>
							  				<th>Relation to / from</th>
											<th>Meta Info</th>
							  			</tr>
							  			<tr ng-repeat='rel in item.Relations' ng-show='attributeMatchesFilter(rel.Name)'>
												<td ng-click='toggleSelectRelation(rel.RelatedAsset.href, rel.Name)' ng-class='{selected: selectedRelation(rel.Name)}'>
							  					<i class='icon-ok' ng-show='!selectedRelation(rel.Name)'>&nbsp;</i>
							  					<i class='icon-remove' ng-show='selectedRelation(rel.Name)'></i>
							  					{{rel.Name}}
											</td>
							  				<td><span ng-show='!rel.IsMultivalue'>Single Value</span> <span ng-show='rel.IsMultivalue'>Multivalue</span>
							  				</td>
							  				<td class='relation'>{{rel.RelatedAsset.nameref}}
											  	<i class='icon-arrow-right'></i>&nbsp;<i class='icon-arrow-left'></i>&nbsp;{{rel.ReciprocalRelation.tokenref.split('.')[1]}}
							  				<td>
							  					<span class='badge badge-important' ng-show='rel.IsRequired'>required</span> <span class='badge badge-warning' ng-show='rel.IsReadOnly'>read only</span> <span class='badge badge-success' ng-show='!rel.IsReadOnly'>read/write</span>
							  				</td>
							  			</tr>
							  		</table>
						      </md-tab>
						    </md-tabs>
						  </md-content>
						</div>
					</div>
				</div>
			</div>
			<div class='span4'>
				<strong>Query Definition</strong>:
				<label class="radio-inline pull-right"">
					<input type="radio" name="inlineRadioOptionsPayload" value="yaml" ng-model='radioOptionPayload'> yaml view
					<input type="radio" name="inlineRadioOptionsPayload" value="json" ng-model='radioOptionPayload'> json view
				</label>
				<br />
				<md-content flex layout-padding>
					<pre class='well'>{{queryRender()}}</pre>
				</md-content>
				<br />
				<button class="btn btn-info" ng-click='tryIt()'>Try it!</button>
				<label class="radio-inline pull-right"">
					<input type="radio" name="inlineRadioOptions" value="raw" ng-model='radioOption'> raw view
					<input type="radio" name="inlineRadioOptions" value="json" ng-model='radioOption'> json formatted
				</label><br />
				<pre class='well' ng-show="showFormatted('json')">
					<json-formatter open="100" json="queryResult"></json-formatter>
				</pre>
				<pre class='well' ng-show="showFormatted('raw')">
					{{queryResult}}
				</pre>
			</div>
   	</section>
	</section>

	<script src='app.coffee' type='text/coffeescript'></script>
	<script type="text/javascript" src="js/coffee-script.min.js"></script>

</body>
</html>
